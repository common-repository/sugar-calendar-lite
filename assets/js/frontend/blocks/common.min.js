var SugarCalendarBlocks=window.SugarCalendarBlocks||function(o){const a={init(){o(a.ready)},ready(){o("body").on("click",a.events.closePopoversOnBodyClick)},events:{closePopoversOnBodyClick(e){!o(this).hasClass("sugar-calendar-block__popovers__active")||(e=o(e.target)).hasClass("sugar-calendar-block__controls__left__date")||e.hasClass("sugar-calendar-block__controls__right__settings__btn")||e.hasClass("sugar-calendar-block__controls__right__view__btn")||e.hasClass("sugar-calendar-block__event-cell")||e.hasClass("sugar-calendar-block__popover")||0<e.parents(".sugar-calendar-block__controls__left__date").length||0<e.parents(".sugar-calendar-block__controls__right__settings__btn").length||0<e.parents(".sugar-calendar-block__controls__right__view__btn").length||0<e.parents(".sugar-calendar-block__event-cell").length||0<e.parents(".sugar-calendar-block__popover").length||a.hideAllPopovers()}},hideAllPopovers(){var e=o("body");e.find(".sugar-calendar-block__popover").removeClass("sugar-calendar-block__controls__settings__btn_active").hide(),e.find(".sugar-calendar-block__controls__settings__btn").removeClass("sugar-calendar-block__controls__settings__btn_active"),e.find(".sugar-calendar-block__controls__left__date").removeClass("sugar-calendar-block__controls__settings__btn_active"),e.removeClass("sugar-calendar-block__popovers__active")}};return a}((document,window,jQuery));SugarCalendarBlocks.init(),SugarCalendarBlocks.Controls=SugarCalendarBlocks.Controls||function(e){this.$blockContainer=e,this.$baseContainer=e.find(".sugar-calendar-block__base-container"),this.$datePicker=e.find(".sugar-calendar-block__controls__datepicker"),this.$formContainer=e.find(".sugar-calendar-block-settings"),this.$searchContainer=e.find(".sugar-calendar-block__controls__right__search__field"),this.$searchClear=e.find(".sugar-calendar-block__controls__right__search__clear"),this.$timeOfDayContainer=e.find(".sugar-calendar-block__popover__calendar_selector__container__time"),this.$daysOfWeekContainer=e.find(".sugar-calendar-block__popover__calendar_selector__container__days"),this.initDatePicker(),this.$blockContainer.find(".sugar-calendar-block__popover__display_selector__container__body__option").on("click",this.onChangeDisplay.bind(this)),this.$blockContainer.find(".sugar-calendar-block__controls__left__pagination__prev").on("click",this.goToPrevious.bind(this)),this.$blockContainer.find(".sugar-calendar-block__controls__left__pagination__next").on("click",this.goToNext.bind(this)),this.$blockContainer.find(".sugar-calendar-block__controls__left__pagination__current").on("click",this.goToCurrent.bind(this)),this.$blockContainer.find(".sugar-calendar-block__popover__calendar_selector__container__options__val__cal").on("click",this.onSelectCalendar.bind(this)),this.$blockContainer.find(".sugar-calendar-block__popover__calendar_selector__container__options__val__day").on("change",this.filterDisplayedEvents.bind(this)),this.$blockContainer.find(".sugar-calendar-block__popover__calendar_selector__container__options__val__time").on("change",this.filterDisplayedEvents.bind(this)),this.$searchContainer.on("keyup",this.onSearch.bind(this)),this.$searchContainer.on("focus",this.onSearchFieldFocus.bind(this)),this.$searchContainer.on("focusout",this.onSearchFieldFocusOut.bind(this)),this.$blockContainer.find(".sugar-calendar-block__controls__right__search__icon").on("click",this.onSearchClick.bind(this)),this.$searchClear.on("click",this.onClearSearch.bind(this)),new SugarCalendarBlocks.Controls.Popovers(e),this.$blockContainer.on("block:preupdate",this.onPreUpdate.bind(this)),this.$blockContainer.on("block:postupdate",this.onPostUpdate.bind(this))},SugarCalendarBlocks.Controls.prototype.onPreUpdate=function(e,o){this.$baseContainer.addClass("sugar-calendar-block__loading-state"),this.$baseContainer.prepend('<div class="sugar-calendar-block__base-container__overlay"><div class="sugar-calendar-block__loading"></div></div>')},SugarCalendarBlocks.Controls.prototype.onPostUpdate=function(e,o){this.$baseContainer.removeClass("sugar-calendar-block__loading-state"),this.$baseContainer.find(".sugar-calendar-block__base-container__overlay").remove()},SugarCalendarBlocks.Controls.prototype.getDisplayMode=function(){return this.$formContainer.find('input[name="sc_display"]').val()},SugarCalendarBlocks.Controls.prototype.getCalendarIds=function(){let e=[];return this.$blockContainer.find(".sugar-calendar-block__popover__calendar_selector__container__options__val__cal:checked").each(function(){e.push(jQuery(this).val())}),e},SugarCalendarBlocks.Controls.prototype.getCalendarsFilter=function(){var e=this.$formContainer.find('input[name="sc_calendars_filter"]');return e.length<=0||(e=e.val()).length<=0?[]:e.split(",")},SugarCalendarBlocks.Controls.prototype.onChangeDisplay=function(e){var e=jQuery(e.target).text().trim(),o=e.toLowerCase();o!==this.getDisplayMode()&&(this.$formContainer.find('input[name="sc_display"]').val(o),this.$blockContainer.find(".sugar-calendar-block__controls__right__view__btn span").text(e),this.update({update_display:!0}))},SugarCalendarBlocks.Controls.prototype.update=function(e){this.$blockContainer.trigger("block:preupdate",[e]),this.$blockContainer.trigger("block:update",[e]),this.$blockContainer.trigger("block:postupdate",[e])},SugarCalendarBlocks.Controls.prototype.goToPrevious=function(){this.update({action:"previous_week"})},SugarCalendarBlocks.Controls.prototype.goToNext=function(){this.update({action:"next_week"})},SugarCalendarBlocks.Controls.prototype.goToCurrent=function(){var e=this.$blockContainer.data();this.$formContainer.find('input[name="sc_year"]').val(e.ogyear),this.$formContainer.find('input[name="sc_month"]').val(e.ogmonth),this.$formContainer.find('input[name="sc_day"]').val(e.ogday),this.update({})},SugarCalendarBlocks.Controls.prototype.onSelectCalendar=function(){this.update({})},SugarCalendarBlocks.Controls.prototype.onSearch=function(e){13===e.keyCode?this.update({}):0<e.target.value.length?this.$searchClear.show():this.$searchClear.hide()},SugarCalendarBlocks.Controls.prototype.onSearchFieldFocus=function(e){jQuery(e.target).parent(".sugar-calendar-block__controls__right__search").addClass("sugar-calendar-block__controls__right__search--active")},SugarCalendarBlocks.Controls.prototype.onSearchFieldFocusOut=function(e){jQuery(e.target).parent(".sugar-calendar-block__controls__right__search").removeClass("sugar-calendar-block__controls__right__search--active")},SugarCalendarBlocks.Controls.prototype.onSearchClick=function(e){this.update({})},SugarCalendarBlocks.Controls.prototype.onClearSearch=function(e){this.$searchContainer.val(""),this.$searchClear.hide(),this.update({})},SugarCalendarBlocks.Controls.prototype.filterDisplayedEvents=function(){this.$blockContainer.trigger("block:filterDisplayedEvents",[{}])},SugarCalendarBlocks.Controls.prototype.initDatePicker=function(){void 0!==this.$datePicker&&this.$datePicker.datepicker("destroy"),this.$datePicker.datepicker({minViewMode:0,maxViewMode:2,templates:{leftArrow:'<svg width="6" height="11" viewBox="0 0 6 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.41406 10.6094C5.29688 10.7266 5.13281 10.7266 5.01562 10.6094L0.09375 5.71094C0 5.59375 0 5.42969 0.09375 5.3125L5.01562 0.414062C5.13281 0.296875 5.29688 0.296875 5.41406 0.414062L5.88281 0.859375C5.97656 0.976562 5.97656 1.16406 5.88281 1.25781L1.64062 5.5L5.88281 9.76562C5.97656 9.85938 5.97656 10.0469 5.88281 10.1641L5.41406 10.6094Z" fill="currentColor"/></svg>',rightArrow:'<svg width="6" height="11" viewBox="0 0 6 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.5625 0.414062C0.679688 0.296875 0.84375 0.296875 0.960938 0.414062L5.88281 5.3125C5.97656 5.42969 5.97656 5.59375 5.88281 5.71094L0.960938 10.6094C0.84375 10.7266 0.679688 10.7266 0.5625 10.6094L0.09375 10.1641C0 10.0469 0 9.85938 0.09375 9.76562L4.33594 5.5L0.09375 1.25781C0 1.16406 0 0.976562 0.09375 0.859375L0.5625 0.414062Z" fill="currentColor"/></svg>'},weekStart:sc_frontend_blocks_common_obj.settings.sow});let o=this.$formContainer.find('input[name="sc_year"]'),a=this.$formContainer.find('input[name="sc_month"]'),t=this.$formContainer.find('input[name="sc_day"]'),n=this;this.$datePicker.datepicker("update",new Date(o.val(),a.val()-1,t.val())),this.$datePicker.on("changeDate",e=>{o.val(e.date.getFullYear()),a.val(e.date.getMonth()+1),t.val(e.date.getDate()),n.update({})})},SugarCalendarBlocks.Controls.prototype.updateDate=function(e){this.$formContainer.find('input[name="sc_year"]').val(e.year),this.$formContainer.find('input[name="sc_month"]').val(e.month),this.$formContainer.find('input[name="sc_day"]').val(e.day),this.$datePicker.datepicker("update",new Date(e.year,e.month-1,e.day))},SugarCalendarBlocks.Controls.prototype.getTimeOfDay=function(){return this.$timeOfDayContainer.find(".sugar-calendar-block__popover__calendar_selector__container__options__val__time:checked").map((e,o)=>o.value).get()},SugarCalendarBlocks.Controls.prototype.getDaysOfWeek=function(){return this.$daysOfWeekContainer.find(".sugar-calendar-block__popover__calendar_selector__container__options__val__day:checked").map((e,o)=>o.value).get()},SugarCalendarBlocks.Controls.Popovers=SugarCalendarBlocks.Controls.Popovers||function(e){this.$blockContainer=e;let a=[{key:"month_selector",popover_selector:".sugar-calendar-block__popover__month_selector",button_selector:".sugar-calendar-block__controls__left__date"},{key:"calendar_selector",popover_selector:".sugar-calendar-block__popover__calendar_selector",button_selector:".sugar-calendar-block__controls__right__settings__btn"},{key:"display_selector",popover_selector:".sugar-calendar-block__popover__display_selector",button_selector:".sugar-calendar-block__controls__right__view__btn"}];const t=this;a.forEach(e=>{var o=this.$blockContainer.find(e.button_selector);o.on("click",t.toggle.bind(t,o,e.key,a))})},SugarCalendarBlocks.Controls.Popovers.prototype.toggle=function(e,o,a){a=a.find(e=>e.key===o),a=this.$blockContainer.find(a.popover_selector);SugarCalendarBlocks.hideAllPopovers(),a.is(":visible")||this.show(e,a,o)},SugarCalendarBlocks.Controls.Popovers.prototype.show=function(e,a,o){var t=window.innerWidth<768,n=[FloatingUIDOM.offset(10),FloatingUIDOM.shift()];t?e[0].scrollIntoView({behavior:"smooth"}):n.push(FloatingUIDOM.flip()),FloatingUIDOM.computePosition(e[0],a[0],{placement:"calendar_selector"===o?"bottom-end":"bottom-start",middleware:n}).then(({x:e,y:o})=>{Object.assign(a[0].style,{left:e+"px",top:o+"px"})}),e.addClass("sugar-calendar-block__controls__settings__btn_active"),a.show(),this.$blockContainer.parents("body").addClass("sugar-calendar-block__popovers__active")};