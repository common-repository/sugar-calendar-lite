"use strict";const SCAdminImporters=window.SCAdminImporters||function(n){const m={runtime_vars:{importer_slug:"",number_of_retries:0,total_number_to_import:{events:null,tickets:null,orders:null,attendees:null},number_of_success_import:{events:0,tickets:0,orders:0,attendees:0},last_migrated_context:null,doms:{$import_file_field:null,$import_file_info_span:null,$import_sc_btn:null,$importer_logs:null,$importer_logs_status:null}},init(){n(m.ready)},ready(){m.cacheDom(),m.bindEvents()},cacheDom(){m.runtime_vars.doms.$import_file_info_span=n("#sc-admin-tools-form-import-file-info"),m.runtime_vars.doms.$import_file_field=n("#sc-admin-tools-form-import"),m.runtime_vars.doms.$import_sc_btn=n("#sc-admin-tools-sc-import-btn"),m.runtime_vars.doms.$importer_logs=n("#sc-admin-importer-tec-logs"),m.runtime_vars.doms.$importer_logs_status=n("#sc-admin-importer-tec-logs__status")},bindEvents(){n("#sc-admin-tools-import-btn").on("click",function(t){t.preventDefault();const r=n(this);t=r.data("warning");t&&"1"===t.toString()?n.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,type:"orange",icon:m.getIcon("exclamation-circle-solid-orange"),title:sc_admin_importers.strings.heads_up,content:sc_admin_importers.strings.recurring_events_warning,buttons:{confirm:{text:sc_admin_importers.strings.yes,btnClass:"btn-confirm",keys:["enter"],action:function(){m.performImport(r)}},cancel:{text:sc_admin_importers.strings.cancel,btnClass:"btn-cancel"}}}):m.performImport(r)}),n("#sc-admin-tools-sc-import-btn").on("click",function(t){var r=n(this);r.find(".sc-admin-tools-sc-import-btn__text").addClass("sc-admin-tools__invisible"),r.append('<span class="sc-admin-tools-loading-spinner"></span>'),r.blur()}),m.runtime_vars.doms.$import_file_field.on("change",function(t){t.target.value&&(m.runtime_vars.doms.$import_file_info_span.text(t.target.value.split("\\").pop()),m.runtime_vars.doms.$import_sc_btn.removeClass("sc-admin-tools-disabled"))})},performImport(t){void 0!==t.data("importer")&&(m.runtime_vars.importer_slug=t.data("importer")),n("#sc-admin-importer-tec-status").text(sc_admin_importers.strings.migration_in_progress).show(),m.runImporter(),t.prop("disabled",!0),t.hide()},getIcon(t){return'"></i><img src="'+sc_admin_importers.assets_url+"images/icons/"+t+'.svg" style="width: 40px; height: 40px;" alt="Icon"><i class="'},runImporter(){n.post(sc_admin_importers.ajax_url,{nonce:sc_admin_importers.nonce,action:"sc_admin_importer",importer_slug:m.runtime_vars.importer_slug,total_number_to_import:m.runtime_vars.total_number_to_import},function(t){t.success?(m.runtime_vars.last_migrated_context||(m.runtime_vars.last_migrated_context=t.data.importer.process),m.runtime_vars.doms.$importer_logs_status.text(sc_admin_importers.strings[t.data.importer.status]),"complete"===t.data.importer.status?(n("#sc-admin-importer-tec-status").text(sc_admin_importers.strings.migration_completed),t.data.importer.error_html&&0<t.data.importer.error_html.length&&n("#sc-admin-importer-tec-logs").after(t.data.importer.error_html)):("hidden"!==t.data.importer.process&&(m.showLogs(t.data.importer.process,t.data.importer.progress,t.data.importer.total_number_to_import),t.data.importer.attendees_count)&&m.showLogs("attendees",t.data.importer.attendees_count,t.data.importer.attendees_total_count),m.runImporter())):m.retryAttempt()}).fail(function(t){m.retryAttempt()})},showLogs(r,s,e){m.runtime_vars.number_of_success_import[r]+=s;var s="sc-admin-importer-tec-logs__progress-"+r,i="sc-admin-importer-tec-logs__process-"+r,o=m.runtime_vars.number_of_success_import[r];if(0<n("#"+i).length)n("#"+s).text(o);else{m.runtime_vars.total_number_to_import[r]||(m.runtime_vars.total_number_to_import[r]=e);let t="";void 0!==e&&(t="/"+m.runtime_vars.total_number_to_import[r]),m.runtime_vars.doms.$importer_logs.append('<div id="'+i+'" class="sc-admin-tools-migrate-context"><div class="sc-admin-tools-migrate-context__status"><div class="sc-admin-tools-migrate-context__status__in-progress"></div></div><div class="sc-admin-tools-migrate-context__info">'+sc_admin_importers.strings["migrated_"+r]+' <span id="'+s+'">'+o+"</span>"+t+"</div></div>")}o>=m.runtime_vars.total_number_to_import[r]&&n("#sc-admin-importer-tec-logs__process-"+r).find(".sc-admin-tools-migrate-context__status").html('<div class="sc-admin-tools-migrate-context__status__complete"></div>')},retryAttempt(){5<=m.runtime_vars.number_of_retries?alert(sc_admin_importers.strings.migration_failed):(++m.runtime_vars.number_of_retries,m.runImporter())}};return m}((document,window,jQuery));SCAdminImporters.init();